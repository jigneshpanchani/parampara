import{r,w as R,o as G,a as Y,b as i,c as d,d as Z,v as q,e,F as E,f as J,n as N,t as V,g as L,T as ue,h as ve,i as _,u as me,j as P,A as pe,Z as he,k as ge,p as fe,l as _e}from"./app-408809c0.js";import{_ as xe}from"./AdminLayout-338b7225.js";import{M as ye,_ as we}from"./Modal-962b7dca.js";import{_ as B}from"./InputLabel-756c6093.js";import{_ as be}from"./_plugin-vue_export-helper-c27b6911.js";const ke=e("svg",{class:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 3a.75.75 0 01.55.24l3.25 3.5a.75.75 0 11-1.1 1.02L10 4.852 7.3 7.76a.75.75 0 01-1.1-1.02l3.25-3.5A.75.75 0 0110 3zm-3.76 9.2a.75.75 0 011.06.04l2.7 2.908 2.7-2.908a.75.75 0 111.1 1.02l-3.25 3.5a.75.75 0 01-1.1 0l-3.25-3.5a.75.75 0 01.04-1.06z","clip-rule":"evenodd"})],-1),Ce=[ke],Me={key:0,class:"absolute z-10 mt-1 max-h-40 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm cursor-pointer",id:"options",role:"listbox","aria-labelledby":"combobox"},$e=["onClick","onMouseenter"],Le=e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z","clip-rule":"evenodd"})],-1),Ve=[Le],se={__name:"SearchableDropdownNew",props:["options","modelValue","editMode"],emits:["onchange"],setup(y,{emit:j}){const w=y,x=r(w.options),n=r(""),F=r(!1),m=r(-1),g=r(!1),h=()=>{const a=new RegExp(n.value,"i");x.value=w.options.filter(p=>a.test(p.name))},b=()=>{n.value="",h()},M=(a,p)=>{n.value=a,F.value=!1,g.value=!1,j("onchange",p,a)},D=()=>{w.editMode||(F.value=!0),g.value||b()},A=a=>{m.value=a};R(()=>w.options,()=>{h()}),R(()=>w.modelValue,a=>{a===""&&b()}),G(()=>{const a=w.options.find(p=>p.id===w.modelValue);a?(n.value=a.name,g.value=!1):b(),document.addEventListener("click",U)}),Y(()=>{document.removeEventListener("click",U)});const U=a=>{a.target.closest(".relative")||(F.value=!1)};return(a,p)=>(i(),d("div",null,[Z(e("input",{id:"combobox",type:"text",placeholder:"Search...",role:"combobox","onUpdate:modelValue":p[0]||(p[0]=k=>n.value=k),onInput:h,onFocus:D,autocomplete:"off",class:"w-full rounded-md border-0 bg-white py-1.5 pl-3 pr-7 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,544),[[q,n.value]]),e("button",{type:"button",class:"absolute inset-y-0 right-0 flex items-center rounded-r-md px-2 focus:outline-none",onClick:D},Ce),F.value&&x.value.length?(i(),d("ul",Me,[(i(!0),d(E,null,J(x.value,(k,$)=>(i(),d("li",{class:N(["relative cursor-default select-none py-2 pl-3 pr-9 cursor-pointer",{"text-white bg-indigo-600":m.value===$,"text-gray-900":m.value!==$}]),key:$,onClick:z=>M(k.name,k.id),onMouseenter:z=>A($),tabindex:"-1",role:"option"},[e("span",{class:N(["block truncate",{"font-semibold":k.name===n.value}])},V(k.name),3),k.name===n.value?(i(),d("span",{key:0,class:N(["absolute inset-y-0 right-0 flex items-center pr-4",{"text-white":m.value===$,"text-indigo-600":m.value!==$}])},Ve,2)):L("",!0)],42,$e))),128))])):L("",!0)]))}};const C=y=>(fe("data-v-722914bd"),y=y(),_e(),y),Fe={class:"flex justify-between items-center mb-6"},Ae=C(()=>e("h1",{class:"text-2xl font-semibold text-gray-900"},"User Activity",-1)),Se={class:"ml-6 flex space-x-6 mt-4 sm:mt-0 w-64"},je={class:"flex focus-within:shadow-lg relative rounded-lg border border-gray-200 w-full"},De=C(()=>e("svg",{class:"pointer-events-none absolute inset-y-0 left-0 h-full w-5 text-gray-400 ml-2",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z","clip-rule":"evenodd"})],-1)),Oe={class:"mt-4 p-6 bg-white shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg"},Te={class:"flex mb-2"},Be=C(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-5 w-5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 6h18M4 10h16M5 14h14M6 18h12"})],-1)),Ue={class:"grid grid-cols-1 gap-x-6 gap-y-5 sm:grid-cols-12 items-center"},Ie={class:"sm:col-span-3"},Ee={class:"sm:col-span-3"},Ne={class:"sm:col-span-3"},ze={class:"relative mt-2"},He={class:"sm:col-span-3"},Pe={class:"relative mt-2"},Re={class:"mt-6 w-full"},Ge={key:0,class:"text-center whitespace-nowrap p-10 text-sm font-semibold text-gray-900"},Ye={class:"text-lg font-bold text-gray-800 mb-4"},Ze={class:"relative px-4 py-4 bg-white rounded-lg shadow-md w-full"},qe=["onClick"],Je=C(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",class:"h-6 w-6","x-tooltip":"tooltip"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})],-1)),Ke=[Je],Qe={class:"flex items-start space-x-4 items-center"},We={class:"w-10 h-10"},Xe={key:0,xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",viewBox:"0 0 48 48",fill:"none"},et=C(()=>e("circle",{cx:"24",cy:"24",r:"22",fill:"url(#grad1)",stroke:"#28c62c","stroke-width":"3"},null,-1)),tt=C(()=>e("g",{transform:"translate(10, 12)",stroke:"#FFFFFF","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},[e("rect",{x:"2",y:"4",width:"24",height:"16",rx:"3",ry:"3",fill:"none"}),e("path",{d:"M3 5l10 10 12-10"})],-1)),st=C(()=>e("defs",null,[e("linearGradient",{id:"grad1",x1:"0%",y1:"0%",x2:"100%",y2:"100%"},[e("stop",{offset:"0%",style:{"stop-color":"#3ADF5B","stop-opacity":"1"}}),e("stop",{offset:"100%",style:{"stop-color":"#28c62c","stop-opacity":"1"}})])],-1)),ot=[et,tt,st],lt={key:1,width:"40",height:"40",xmlns:"http://www.w3.org/2000/svg"},at=["fill"],nt={x:"50%",y:"50%","dominant-baseline":"middle","text-anchor":"middle",fill:"#FFF","font-size":"14","font-weight":"bold","font-family":"Arial, sans-serif"},rt={class:"flex flex-col justify-between w-full"},it={class:"flex items-start"},dt={class:"text-gray-700"},ct=["innerHTML"],ut={key:1,class:"text-md font-semibold ml-1"},vt={class:"text-sm text-gray-500"},mt={class:"flex justify-center my-4"},pt={key:0,class:"loader"},ht=C(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"})],-1)),gt=[ht],ft={class:"p-6"},_t=C(()=>e("h2",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Details",-1)),xt=["innerHTML"],yt={class:"mt-4 flex justify-end"},wt={__name:"ActivityLog",props:["activityLogs","user","userId","logNames"],setup(y){const j=y,w=ue({}),x=r(""),n=r(j.userId),F=r("ALL Users"),m=r(""),g=r(""),h=r(""),b=r(null),M=r([...j.activityLogs]),D=r(!0),A=r(!1);R(()=>j.activityLogs,o=>{M.value=[...o]});const U=async()=>{if(!D.value||A.value)return;A.value=!0;const t={offset:M.value.length,search:x.value,causer_id:n.value,from_date:m.value,to_date:g.value,log_name:h.value};try{const s=await pe.get(route("logs.loadMore"),{params:t}),u=s.data.activityLogs;M.value=M.value.concat(u),D.value=s.data.hasMore}catch(s){console.error("Error loading more logs",s)}finally{A.value=!1}};let a=null;G(()=>{a=new IntersectionObserver(o=>{o.forEach(t=>{t.isIntersecting&&U()})}),b.value&&a.observe(b.value)}),Y(()=>{a&&b.value&&a.unobserve(b.value)});const p=(o,t,s,u,l)=>{x.value=o,w.get(route("logs",{search:o,causer_id:t,from_date:s,to_date:u,log_name:l}),{preserveState:!0})},k=()=>{p(x.value,n.value,m.value,g.value,h.value)},$=()=>{p(x.value,n.value,m.value,g.value,h.value)},z=(o,t)=>{n.value=o,F.value=t,p(x.value,n.value,m.value,g.value,h.value)},oe=o=>{h.value=o,p(x.value,n.value,m.value,g.value,h.value)},le=o=>{const t=new Date(o),s={year:"numeric",month:"short",day:"numeric"};return t.toLocaleDateString("en-US",s)},I={created:{color:"text-green-500",svgColor:"#22C55E"},updated:{color:"text-blue-500",svgColor:"#3B82F6"},deleted:{color:"text-red-500",svgColor:"#EF4444"},received:{color:"text-yellow-500",svgColor:"#F59E0B"},payment:{color:"text-purple-500",svgColor:"#8B5CF6"},default:{color:"text-gray-500",svgColor:"#9CA3AF"}},K=ve(()=>M.value.reduce((o,t)=>{const s=le(t.created_at);return o[s]||(o[s]=[]),o[s].push(t),o},{})),ae=o=>{var T;const t=o.properties||{},s=o.event||"",u=((T=I[s])==null?void 0:T.color)||I.default.color;if(!Object.keys(t).some(c=>t[c]&&Object.keys(t[c]).length>0))return"";let v="";return s==="deleted"&&t.old?(v+='<div class="space-y-1">',Object.keys(t.old).forEach(c=>{const f=t.old[c]??"NA",S=`bg-red-100 ${u} px-3 py-1 rounded text-sm`;v+=`
        <div class="flex justify-between items-center">
          <div class="${u} font-medium text-sm">${c}</div>
          <span class="${S}">${f}</span>
        </div>
      `}),v+="</div>",v):(t.attributes&&(v+='<div class="space-y-1">',Object.keys(t.attributes).forEach(c=>{var te;const f=((te=t.old)==null?void 0:te[c])??null,S=t.attributes[c]??"NA",ee=s==="updated"&&f===null?"NA":f,de="bg-red-100 text-red-600 px-3 py-1 rounded text-sm",ce="bg-green-100 text-green-600 px-3 py-1 rounded text-sm";v+=`
        <div class="flex justify-between items-center">
          <div class="${u} font-medium text-sm">${c}</div>
          <div class="flex items-center gap-2">
            ${s==="updated"?`<span class="${de}">${ee}</span>
                   <span class="text-gray-500 text-sm">â†’</span>`:""}
            <span class="${ce}">${S}</span>
          </div>
        </div>
      `}),v+="</div>"),Object.keys(t).forEach(c=>{if(c!=="attributes"&&c!=="old"){v===""&&(v+='<div class="space-y-1">');let f=t[c];typeof f=="string"&&(f=f.replace(/^"|"$/g,"")),v+=`
        <div class="flex justify-between items-center">
          <div class="${u} font-medium text-sm">${c}</div>
          <div class="bg-gray-100 text-gray-800 px-3 py-1 rounded text-sm">${f}</div>
        </div>
      `}}),v?`<div class="space-y-1">${v}</div>`:"")},H=r(!1),O=r(null),Q=()=>{H.value=!1,O.value=null},ne=o=>{O.value=M.value.find(t=>t.id===o),H.value=!0},re=(o="",t="")=>{const s=o.charAt(0).toUpperCase()||"",u=t.charAt(0).toUpperCase()||"";return`${s}${u}`||"U"},W=r(!1),ie=()=>{window.scrollTo({top:0,behavior:"smooth"})},X=()=>{W.value=window.pageYOffset>300};return G(()=>{window.addEventListener("scroll",X)}),Y(()=>{window.removeEventListener("scroll",X)}),(o,t)=>(i(),d(E,null,[_(me(he),{title:"Activity Logs"}),_(xe,null,{default:P(()=>[e("div",Fe,[Ae,e("div",Se,[e("div",je,[De,e("input",{id:"search-field",onInput:t[0]||(t[0]=s=>p(s.target.value,n.value,m.value,g.value,h.value)),class:"rounded-lg block h-full w-full border-0 pl-8 text-gray-900 placeholder:text-gray-400 focus:ring-0 sm:text-sm",placeholder:"Search...",type:"search",name:"search"},null,32)])])]),e("div",Oe,[e("div",Te,[Be,_(B,{for:"customer_id",value:"Filters"})]),e("div",Ue,[e("div",Ie,[_(B,{for:"date",value:"From Date"}),Z(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>m.value=s),class:"mt-2 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",type:"date",onChange:k},null,544),[[q,m.value]])]),e("div",Ee,[_(B,{for:"date",value:"To Date"}),Z(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>g.value=s),class:"mt-2 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",type:"date",onChange:$},null,544),[[q,g.value]])]),e("div",Ne,[_(B,{for:"log_name",value:"Task"}),e("div",ze,[_(se,{options:[{id:"",name:"All Task"},...y.logNames.map(s=>({id:s,name:s}))],modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=s=>h.value=s),onOnchange:oe},null,8,["options","modelValue"])])]),e("div",He,[_(B,{for:"customer_id",value:"Users"}),e("div",Pe,[_(se,{options:y.user,modelValue:n.value,"onUpdate:modelValue":t[4]||(t[4]=s=>n.value=s),onOnchange:z},null,8,["options","modelValue"])])])])]),e("div",Re,[Object.keys(K.value).length===0?(i(),d("div",Ge," No activity logs found. ")):L("",!0),(i(!0),d(E,null,J(K.value,(s,u)=>(i(),d("div",{key:u,class:"mb-8"},[e("h2",Ye,V(u),1),(i(!0),d(E,null,J(s,l=>{var v,T,c,f,S;return i(),d("div",{key:l.id,class:"flex items-start mb-4"},[e("div",Ze,[l.log_name!=="Number Setting Update"?(i(),d("button",{key:0,onClick:ee=>ne(l.id),class:"absolute top-1/2 right-0 transform -translate-y-1/2 px-6 text-gray-500 hover:text-gray-700 rounded-full"},Ke,8,qe)):L("",!0),e("div",Qe,[e("div",We,[l.event==="sent"?(i(),d("svg",Xe,ot)):(i(),d("svg",lt,[e("circle",{cx:"20",cy:"20",r:"20",fill:((v=I[l.event])==null?void 0:v.svgColor)||"#3B82F6"},null,8,at),e("text",nt,V(re((T=l.causer)==null?void 0:T.first_name,(c=l.causer)==null?void 0:c.last_name)),1)]))]),e("div",rt,[e("div",it,[e("p",dt,[l.description?(i(),d("span",{key:0,class:"",innerHTML:l.description},null,8,ct)):L("",!0),l.log_name!=="PaymentPaid"&&l.log_name!=="Payment-Receive"&&l.log_name!=="Send-Invoice-Email"?(i(),d("span",ut,V(((f=l.causer)==null?void 0:f.first_name)||"Unknown")+" "+V(((S=l.causer)==null?void 0:S.last_name)||""),1)):L("",!0)])]),e("div",vt,V(new Date(l.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})),1)])])])])}),128))]))),128)),e("div",mt,[A.value?(i(),d("div",pt)):L("",!0)]),e("div",{ref_key:"sentinel",ref:b,class:"h-1"},null,512)]),W.value?(i(),d("button",{key:0,onClick:ie,class:"fixed bottom-5 right-5 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg"},gt)):L("",!0),_(ye,{show:H.value,onClose:Q},{default:P(()=>{var s,u,l;return[e("div",ft,[_t,e("p",{class:N([((u=I[(s=O.value)==null?void 0:s.event])==null?void 0:u.color)||"text-gray-700","text-md mb-4 font-semibold"])},V((l=O.value)==null?void 0:l.event)+" details: ",3),e("div",{class:"overflow-y-auto p-4 mb-4 border rounded-lg shadow-sm bg-white",style:{"max-height":"340px"},innerHTML:ae(O.value)},null,8,xt),e("div",yt,[_(we,{onClick:Q},{default:P(()=>[ge("Close")]),_:1})])])]}),_:1},8,["show"])]),_:1})],64))}},Lt=be(wt,[["__scopeId","data-v-722914bd"]]);export{Lt as default};
